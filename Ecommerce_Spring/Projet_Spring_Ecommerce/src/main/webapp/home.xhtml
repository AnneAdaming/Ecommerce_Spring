<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>Home Ecommerce</title>
	
	<f:event listener="#{categorieMB.initListener}" type="preRenderView" />
	<f:event listener="#{produitMB.initListener}" type="preRenderView" />
</h:head>
<h:body>
	<p:growl />
	<!-- ================================ MenuBar ================================ -->
	<h:form id="menubarForm">
		<p:menubar>
			<c:if test="#{sessionScope.logged!=true}">
				<p:menuitem value="Voir le panier" url="panier.xhtml" />
			</c:if>
			<c:if test="#{sessionScope.logged==true}">
				<p:submenu label="Ajout" icon="ui-icon-pencil">
					<p:menuitem value="Admin" url="#" onclick="PF('ajoutAdminDialog').show();" />
					<p:menuitem value="Categorie" url="#" onclick="PF('ajoutCategorieDialog').show();" />
					<p:menuitem value="Produit (popup)" url="#" onclick="PF('ajoutProduitDialog').show();" />
					<p:menuitem value="Produit (page)" url="ajout_produit.xhtml" />
				</p:submenu>
				<p:submenu label="Modification" icon="ui-icon-gear">
					<p:menuitem value="Categorie" url="#" onclick="PF('modifCategorieDialog').show();" />
					<p:menuitem value="Produit (popup)" url="#" onclick="PF('modifProduitDialog').show();" />
					<p:menuitem value="Produit (page)" url="modif_produit.xhtml" />
				</p:submenu>
				<p:submenu label="Suppression" icon="ui-icon-close">
					<p:menuitem value="Categorie" url="#" onclick="PF('supprCategorieDialog').show();" />
					<p:menuitem value="Produit" url="#" onclick="PF('supprProduitDialog').show();" />
				</p:submenu>
			</c:if>
			<f:facet name="options">
				<c:if test="#{sessionScope.logged!=true}">
					<p:commandButton value="Login" onclick="PF('loginDialog').show();" style="margin-right:10px" />
				</c:if>
				<c:if test="#{sessionScope.logged==true}">
					<p:outputLabel value="#{adminMB.admin.email}" style="margin-right:10px" />
					<p:commandButton value="Logout" action="#{adminMB.logout}" icon="ui-icon-extlink" />
				</c:if>
			</f:facet>
		</p:menubar>
	</h:form>
	
	<!-- ================================ WIP ================================ -->
	<h:form enctype="multipart/form-data">
		<p:messages showDetail="true" />
		<p:fileUpload value="#{imageStoreBean.file}" mode="simple" />
		<p:commandButton value="Submit" ajax="false" actionListener="#{imageStoreBean.storeImage}" />
		<h:graphicImage id="image" alt="uploaded image" url="/image"/>
	</h:form>
	
	<p:media value="https://www.youtube.com/v/2yMyor-Sd1Q" player="flash"/>

	<h:form>
		<h:commandButton value="Envoyer Mail" action="#{testMB.sendMail}" />
		<h:commandButton value="Exporter Pdf" action="#{testMB.exportPdf}" />
	</h:form>
	
	<!-- ================================ Tableaux de DonnÃ©es ================================ -->
	<p:dataTable var="categorie" value="#{sessionScope.listeCategories}">
	    <p:column headerText="Id">
	        <h:outputText value="#{categorie.id}" />
	    </p:column>
	    <p:column headerText="Nom">
	        <h:outputText value="#{categorie.nomCategorie}" />
	    </p:column>
	    <p:column headerText="Description">
	        <h:outputText value="#{categorie.description}" />
	    </p:column>
	</p:dataTable>
	
	<br/>
	<br/>
	
	<p:dataTable var="produit" value="#{sessionScope.listeProduits}">
	    <p:column headerText="Id">
	        <h:outputText value="#{produit.id}" />
	    </p:column>
	    <p:column headerText="Designation">
	        <h:outputText value="#{produit.designation}" />
	    </p:column>
	    <p:column headerText="Description">
	        <h:outputText value="#{produit.description}" />
	    </p:column>
	    <p:column headerText="Illustration">
	        <p:graphicImage value="#{imageMB.image}" width="150px">
	        	<f:param name="id" value="#{produit.id}" />
	        </p:graphicImage>
	    </p:column>
	    <p:column headerText="Prix">
	        <h:outputText value="#{produit.prix}" />
	    </p:column>
	    <p:column headerText="Quantite">
	        <h:outputText value="#{produit.quantite}" />
	    </p:column>
	    <p:column headerText="Categorie">
	        <h:outputText value="#{produit.categorie.nomCategorie}" />
	    </p:column>
	    <p:column headerText="Ajouter au panier">
	    	<h:form>
	    		<h:commandButton value="+1" action="#{panierMB.augmenter}">
	    			<f:setPropertyActionListener target="#{panierMB.idProduit}" value="#{produit.id}" />
	    		</h:commandButton>
	    	</h:form>
	    </p:column>
	    <p:column headerText="Enlever du panier">
	    	<h:form>
	    		<h:commandButton value="-1" action="#{panierMB.diminuer}">
	    			<f:setPropertyActionListener target="#{panierMB.idProduit}" value="#{produit.id}" />
	    		</h:commandButton>
	    	</h:form>
	    </p:column>
	</p:dataTable>
	
	
	<!-- ================================ Dialogs ================================ -->
	<h:form>
		<p:dialog header="Login" widgetVar="loginDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="loginId">
				<p:outputLabel for="emailId" value="Mail : " />
				<p:inputText id="emailId" value="#{adminMB.admin.email}" required="true" />
				<p:message for="emailId" style="color: red" />
				<p:outputLabel for="mdpId" value="Mdp : " />
				<p:password id="mdpId" value="#{adminMB.admin.mdp}" required="true" />
				<p:message for="mdpId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Login" action="#{adminMB.login}" update="loginId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Ajout Admin" widgetVar="ajoutAdminDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="ajoutAdminId">
				<p:outputLabel for="emailId" value="Mail : " />
				<p:inputText id="emailId" value="#{adminMB.admin.email}" required="true" />
				<p:message for="emailId" style="color: red" />
				<p:outputLabel for="mdpId" value="Mdp : " />
				<p:inputText id="mdpId" value="#{adminMB.admin.mdp}" required="true" />
				<p:message for="mdpId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Ajouter" action="#{adminMB.addAdmin}" update="ajoutAdminId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Ajout Categorie" widgetVar="ajoutCategorieDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="ajoutCategorieId">
				<p:outputLabel for="nomCategorieId" value="Nom Categorie : " />
				<p:inputText id="nomCategorieId" value="#{categorieMB.categorie.nomCategorie}" required="true" />
				<p:message for="nomCategorieId" style="color: red" />
				<p:outputLabel for="descriptionId" value="Description : " />
				<p:inputText id="descriptionId" value="#{categorieMB.categorie.description}" required="true" />
				<p:message for="descriptionId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Ajouter" action="#{categorieMB.addCategorie}" update="ajoutCategorieId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Ajout Produit" widgetVar="ajoutProduitDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="ajoutProduitId">
				<p:outputLabel for="designationId" value="Designation : " />
				<p:inputText id="designationId" value="#{produitMB.produit.designation}" required="true" />
				<p:message for="designationId" style="color: red" />
				<p:outputLabel for="descriptionId" value="Description : " />
				<p:inputText id="descriptionId" value="#{produitMB.produit.description}" required="true" />
				<p:message for="descriptionId" style="color: red" />
				<p:outputLabel for="prixId" value="Prix : " />
				<p:inputText id="prixId" value="#{produitMB.produit.prix}" required="true" />
				<p:message for="prixId" style="color: red" />
				<p:outputLabel for="quantiteId" value="Quantite : " />
				<p:inputText id="quantiteId" value="#{produitMB.produit.quantite}" required="true" />
				<p:message for="quantiteId" style="color: red" />
				<p:outputLabel for="categorieId" value="Categorie : " />
				<p:selectOneMenu id="categorieId" value="#{produitMB.categorieIdString}">
					<c:forEach var="categorie" items="#{sessionScope.listeCategories}">
						<f:selectItem itemLabel="#{categorie.nomCategorie}" itemValue="#{categorie.id}" />
					</c:forEach>
				</p:selectOneMenu>
				<p:messages showDetail="true" />
				<p:fileUpload value="#{produitMB.imageFichier}" mode="simple" />
				<p:message for="categorieId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Ajouter" action="#{produitMB.addProduit}" update="ajoutProduitId" ajax="false" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Modification Categorie" widgetVar="modifCategorieDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="modifCategorieId">
				<p:outputLabel for="idId" value="Id : " />
				<p:inputText id="idId" value="#{categorieMB.categorie.id}" required="true" />
				<p:message for="idId" style="color: red" />
				<p:outputLabel for="nomCategorieId" value="Nom Categorie : " />
				<p:inputText id="nomCategorieId" value="#{categorieMB.categorie.nomCategorie}" required="true" />
				<p:message for="nomCategorieId" style="color: red" />
				<p:outputLabel for="descriptionId" value="Description : " />
				<p:inputText id="descriptionId" value="#{categorieMB.categorie.description}" required="true" />
				<p:message for="descriptionId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Modifier" action="#{categorieMB.updateCategorie}" update="modifCategorieId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Modification Produit" widgetVar="modifProduitDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="modifProduitId">
				<p:outputLabel for="idId" value="Id : " />
				<p:inputText id="idId" value="#{produitMB.produit.id}" required="true" />
				<p:message for="idId" style="color: red" />
				<p:outputLabel for="designationId" value="Designation : " />
				<p:inputText id="designationId" value="#{produitMB.produit.designation}" required="true" />
				<p:message for="designationId" style="color: red" />
				<p:outputLabel for="descriptionId" value="Description : " />
				<p:inputText id="descriptionId" value="#{produitMB.produit.description}" required="true" />
				<p:message for="descriptionId" style="color: red" />
				<p:outputLabel for="prixId" value="Prix : " />
				<p:inputText id="prixId" value="#{produitMB.produit.prix}" required="true" />
				<p:message for="prixId" style="color: red" />
				<p:outputLabel for="quantiteId" value="Quantite : " />
				<p:inputText id="quantiteId" value="#{produitMB.produit.quantite}" required="true" />
				<p:message for="quantiteId" style="color: red" />
				<p:outputLabel for="categorieId" value="Categorie : " />
				<p:selectOneMenu id="categorieId" value="#{produitMB.categorieIdString}">
					<c:forEach var="categorie" items="#{sessionScope.listeCategories}">
						<f:selectItem itemLabel="#{categorie.nomCategorie}" itemValue="#{categorie.id}" />
					</c:forEach>
				</p:selectOneMenu>
				<p:message for="categorieId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Modifier" action="#{produitMB.updateProduit}" update="modifProduitId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Suppression Categorie" widgetVar="supprCategorieDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="supprCategorieId">
				<p:outputLabel for="idId" value="Id : " />
				<p:inputText id="idId" value="#{categorieMB.categorie.id}" required="true" />
				<p:message for="idId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Supprimer" action="#{categorieMB.deleteCategorie}" update="supprCategorieId" />
		</p:dialog>
	</h:form>
	
	<h:form>
		<p:dialog header="Suppression Produit" widgetVar="supprProduitDialog" modal="true" resizable="false">
			<h:panelGrid columns="3" id="supprProduitId">
				<p:outputLabel for="idId" value="Id : " />
				<p:inputText id="idId" value="#{produitMB.produit.id}" required="true" />
				<p:message for="idId" style="color: red" />
			</h:panelGrid>
			<p:commandButton value="Supprimer" action="#{produitMB.deleteProduit}" update="supprProduitId" />
		</p:dialog>
	</h:form>
		
</h:body>
</html>